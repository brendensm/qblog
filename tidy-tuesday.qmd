---
title: "tidy tuesday"
execute:
  echo: false
  warning: false
  message: false
  eval: true
format:
  html:
    include-after-body: _lightbox.html
---

An ongoing collection of practice visualizations from the [Tidy Tuesday](https://github.com/rfordatascience/tidytuesday) weekly data project using R and Python.

[R repo](https://github.com/brendensm/TidyTuesday) | [Python repo](https://github.com/brendensm/PydyTuesday)

```{r}
#| output: asis
library(glue)
library(httr)
library(jsonlite)

all_images <- list()

# ---- Fetch from TidyTuesday (R) repo ----
r_api_url <- "https://api.github.com/repos/brendensm/TidyTuesday/contents/output"
r_response <- GET(r_api_url)

if (status_code(r_response) == 200) {
  r_content <- r_response$content |> rawToChar() |> fromJSON()

  image_extensions <- c("png", "jpg", "jpeg", "gif", "svg")
  image_pattern <- paste0("\\.(", paste(image_extensions, collapse = "|"), ")$")
  r_images <- r_content$name[grepl(image_pattern, r_content$name, ignore.case = TRUE)]

  for (img in r_images) {
    year_match <- regmatches(img, regexpr("^\\d{4}", img))
    year <- if (length(year_match) > 0) as.numeric(year_match) else 0

    week_match <- regmatches(img, regexpr("week(\\d+)", img))
    if (length(week_match) > 0) {
      week <- as.numeric(gsub("week", "", week_match))
    } else {
      parts <- strsplit(img, "-")[[1]]
      week <- if (length(parts) >= 2) suppressWarnings(as.numeric(parts[2])) else 0
      week <- if (is.na(week)) 0 else week
    }

    all_images[[length(all_images) + 1]] <- list(
      url = paste0("https://raw.githubusercontent.com/brendensm/TidyTuesday/main/output/", img),
      filename = img,
      year = year,
      week = week,
      source = "R"
    )
  }
}

# ---- Fetch from PydyTuesday (Python) repo ----
py_api_url <- "https://api.github.com/repos/brendensm/PydyTuesday/contents"
py_response <- GET(py_api_url)

if (status_code(py_response) == 200) {
  py_root <- py_response$content |> rawToChar() |> fromJSON()
  year_dirs <- py_root$name[py_root$type == "dir" & grepl("^20\\d{2}$", py_root$name)]

  for (year_dir in year_dirs) {
    year_api <- glue("https://api.github.com/repos/brendensm/PydyTuesday/contents/{year_dir}")
    year_response <- GET(year_api)

    if (status_code(year_response) == 200) {
      year_content <- year_response$content |> rawToChar() |> fromJSON()
      week_dirs <- year_content$name[year_content$type == "dir" & grepl("^week-\\d+$", year_content$name)]

      for (week_dir in week_dirs) {
        week_api <- glue("https://api.github.com/repos/brendensm/PydyTuesday/contents/{year_dir}/{week_dir}")
        week_response <- GET(week_api)

        if (status_code(week_response) == 200) {
          week_content <- week_response$content |> rawToChar() |> fromJSON()
          output_files <- week_content$name[grepl("^output\\.(png|jpg|jpeg|gif|svg)$", week_content$name, ignore.case = TRUE)]

          for (img in output_files) {
            year <- as.numeric(year_dir)
            week <- as.numeric(gsub("week-", "", week_dir))

            all_images[[length(all_images) + 1]] <- list(
              url = glue("https://raw.githubusercontent.com/brendensm/PydyTuesday/main/{year_dir}/{week_dir}/{img}"),
              filename = glue("{year_dir}-{week_dir}-{img}"),
              year = year,
              week = week,
              source = "Python"
            )
          }
        }
      }
    }
  }
}

# Sort by year desc, then week desc
years <- sapply(all_images, function(x) x$year)
weeks <- sapply(all_images, function(x) x$week)
sort_order <- order(-years, -weeks)
all_images <- all_images[sort_order]

# Distribute images round-robin across 3 columns so newest appear across the top
cols <- list(character(0), character(0), character(0))
for (i in seq_along(all_images)) {
  img <- all_images[[i]]
  col_idx <- ((i - 1) %% 3) + 1
  cols[[col_idx]] <- c(cols[[col_idx]], as.character(glue(
    '<a href="{img$url}" data-index="{i}"><img src="{img$url}" alt="{img$filename}" loading="lazy"></a>'
  )))
}

htmltools::browsable(htmltools::HTML(paste0(
  '<div class="gallery">\n',
  paste(vapply(cols, function(col) {
    paste0('<div class="gallery-col">\n', paste(col, collapse = "\n"), '\n</div>')
  }, character(1)), collapse = "\n"),
  '\n</div>'
)))
```
