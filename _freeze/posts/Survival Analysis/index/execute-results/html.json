{
  "hash": "5fe500af592591ba2cea9c40f4c6f355",
  "result": {
    "markdown": "---\ntitle: \"Survival Analysis in R\"\nauthor: \"Brenden Smith\"\ndate: \"2022-10-24\"\ncategories: [R, Epi, ggplot2]\ndescription: \"Exploring survival analysis with the packages 'survival' and 'survminer.'\"\nimage: thumbnail.png\nexecute: \n  warning: false\nformat: \n  html:\n    fig-height: 6\n    fig-width: 8\n---\n\n\n# Survival Analysis\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load in libraries\nlibrary(haven)\nlibrary(dplyr)\nlibrary(survival)\nlibrary(ggthemes)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nFHS <- read_sav(\"data/Cox Prop Hazard Regression Data.sav\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nFHS_surv <- Surv(time = FHS$TimeDeathYears,\n                 event = FHS$death)\nsummary(survfit(FHS_surv ~ 1))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCall: survfit(formula = FHS_surv ~ 1)\n\n time n.risk n.event survival std.err lower 95% CI upper 95% CI\n    2   3263       6    0.998 0.00075        0.997        1.000\n    3   3257      32    0.988 0.00188        0.985        0.992\n    4   3225      53    0.972 0.00288        0.966        0.978\n    5   3172      57    0.955 0.00364        0.948        0.962\n    6   3115      65    0.935 0.00432        0.926        0.943\n    7   3050      64    0.915 0.00488        0.906        0.925\n    8   2986      66    0.895 0.00537        0.884        0.905\n    9   2920      58    0.877 0.00575        0.866        0.888\n   10   2862      76    0.854 0.00618        0.842        0.866\n   11   2786      87    0.827 0.00662        0.814        0.840\n   12   2699      67    0.807 0.00691        0.793        0.820\n   13   2632      69    0.785 0.00719        0.772        0.800\n   14   2563      75    0.762 0.00745        0.748        0.777\n```\n:::\n:::\n\n\n# Kaplan-Meier Plot\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(FHS_surv, \n     xlab = \"Years Since Baseline\",    # x-axis label\n     ylab =\"Survival Probability\",   # y-axis label\n     main = \"Overall survival curve\", # figure title\n     ylim = c(0, 1),\n     mark.time = TRUE,\n     conf.int = FALSE\n)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=768}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nFHS_fit_db <- survfit(Surv(TimeDeathYears, death) ~ diabetes, data = FHS)\n\ncol_diabetes <- c(\"lightblue\", \"darkblue\")\n\nplot(\n  FHS_fit_db,\n  col = col_diabetes,\n  xlab = \"Years since baseline\",\n  ylab = \"Survival Probability\")\nlegend(\n  \"bottomright\",\n  legend = c(\"Not diabetic\",\"Diabetic\"),\n  col = col_diabetes,\n  lty = 1,\n  cex = .9,\n  bty = \"n\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=768}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsurvminer::ggsurvplot(\n  FHS_fit_db, \n  data = FHS,          \n  conf.int = TRUE,  \n  surv.scale = \"percent\",        # present probabilities in the y axis in %\n  break.time.by = 1,            # present the time axis with an increment of years\n  xlab = \"Time Since baseline (Years)\",\n  ylab = \"Survival Probability\",\n  pval = T,       # print p-value at these plot coordinates\n  risk.table = T,                # print the risk table at bottom \n  legend.title = \"Diabetic Status\",       # legend characteristics\n  legend.labs = c(\"not diabetic\",\"diabetic\"),\n  font.legend = 10, \n  palette = \"Dark2\",             # specify color palette \n  surv.median.line = \"hv\",       # draw horizontal and vertical lines to the median survivals\n  ggtheme = theme_few()\n)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.png){width=768}\n:::\n:::\n\n\n# Cox Regression and Hazard Ratios\n\n\n::: {.cell}\n\n```{.r .cell-code}\nFHS_cox <-  coxph(\n  Surv(TimeDeathYears, death) ~ diabetes + cursmoke + diabetes + \n    educ + prevchd + age + bmi + sex,\n  data = FHS\n)\n\nsummary(FHS_cox)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCall:\ncoxph(formula = Surv(TimeDeathYears, death) ~ diabetes + cursmoke + \n    diabetes + educ + prevchd + age + bmi + sex, data = FHS)\n\n  n= 3165, number of events= 746 \n   (98 observations deleted due to missingness)\n\n              coef exp(coef)  se(coef)      z Pr(>|z|)    \ndiabetes  0.732430  2.080129  0.100183  7.311 2.65e-13 ***\ncursmoke  0.433427  1.542535  0.080983  5.352 8.70e-08 ***\neduc     -0.124079  0.883310  0.036412 -3.408 0.000655 ***\nprevchd   0.781816  2.185437  0.086662  9.021  < 2e-16 ***\nage       0.091694  1.096030  0.004996 18.353  < 2e-16 ***\nbmi      -0.014066  0.986032  0.009644 -1.459 0.144676    \nsex       0.657285  1.929546  0.074741  8.794  < 2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n         exp(coef) exp(-coef) lower .95 upper .95\ndiabetes    2.0801     0.4807    1.7093    2.5314\ncursmoke    1.5425     0.6483    1.3161    1.8079\neduc        0.8833     1.1321    0.8225    0.9487\nprevchd     2.1854     0.4576    1.8440    2.5900\nage         1.0960     0.9124    1.0853    1.1068\nbmi         0.9860     1.0142    0.9676    1.0048\nsex         1.9295     0.5183    1.6666    2.2340\n\nConcordance= 0.761  (se = 0.009 )\nLikelihood ratio test= 685.5  on 7 df,   p=<2e-16\nWald test            = 687.1  on 7 df,   p=<2e-16\nScore (logrank) test = 781.6  on 7 df,   p=<2e-16\n```\n:::\n\n```{.r .cell-code}\nsurvminer::ggforest(FHS_cox, data = FHS)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-1.png){width=768}\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}